<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>River-Boat Simulation (Pedagogical Version)</title>
    <style>
        :root {
            --panel-bg: #f4f4f9;
            --border-color: #ccc;
            --accent-color: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background-color: #e0e0e0;
        }

        /* Left Side Panel */
        #side-panel {
            width: 280px;
            background: var(--panel-bg);
            border-right: 2px solid var(--border-color);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px; 
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 10;
        }

        h2 { font-size: 0.95rem; margin: 0; color: var(--accent-color); border-bottom: 1px solid #ddd; padding-bottom: 3px; }
        .param-group { background: white; padding: 8px; border-radius: 5px; border: 1px solid #ddd; }
        .label-val { display: flex; justify-content: space-between; font-weight: bold; font-size: 0.85rem; margin-bottom: 3px; }
        input[type=range] { width: 100%; cursor: pointer; height: 15px; }
        
        .btn-group { display: flex; gap: 5px; }
        button { flex: 1; padding: 8px; cursor: pointer; font-weight: bold; border-radius: 4px; border: 1px solid #999; font-size: 0.85rem; }
        #play-btn { background: #4CAF50; color: white; border: none; }
        #play-btn.paused { background: #f39c12; }
        #reset-btn { background: #e74c3c; color: white; border: none; }

        #live-data-section {
            margin-top: auto;
            border-top: 2px solid #ddd;
            padding-top: 10px;
        }

        /* Simulation Canvas Area */
        #main-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        #canvas-container {
            flex-grow: 1;
            background-color: #b3e5fc; 
            overflow: hidden;
        }

        /* Updated Observation Guide with Buttons */
        #observation-guide-container {
            height: 70px;
            background: #2c3e50;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-top: 3px solid #1a252f;
        }

        #guide-text {
            flex-grow: 1;
            text-align: center;
            font-size: 0.95rem;
            padding: 0 20px;
            font-weight: 500;
            line-height: 1.4;
        }

        .nav-btn {
            background: #34495e;
            color: white;
            border: 1px solid #5d6d7e;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.2s;
        }

        .nav-btn:hover { background: #5d6d7e; }

        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.8rem; }
        .data-item { background: #fff; padding: 5px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>

    <div id="side-panel">
        <h2>Fixed Parameters</h2>
        <div class="param-group">
            <div class="label-val"><span>v<sub>R</sub> (River):</span> <span>3.0 m/s</span></div>
            <div class="label-val"><span>Width (W):</span> <span>20.0 m</span></div>
        </div>

        <h2>Controls</h2>
        <div class="param-group">
            <div class="label-val"><span>v<sub>BR</sub> (Boat):</span> <span id="vbr-val">4 m/s</span></div>
            <input type="range" id="vbr-slider" min="2" max="6" step="1" value="4">
        </div>

        <div class="param-group">
            <div class="label-val"><span>Angle (&theta;):</span> <span id="theta-val">0°</span></div>
            <input type="range" id="theta-slider" min="-45" max="45" step="5" value="0">
        </div>

        <div class="param-group">
            <div class="label-val">Speed</div>
            <select id="time-scale" style="width: 100%; padding: 4px; font-size: 0.8rem;">
                <option value="1">1.0x (Normal)</option>
                <option value="0.5">0.5x</option>
                <option value="0.2">0.2x</option>
            </select>
        </div>

        <div class="btn-group">
            <button id="play-btn">PLAY</button>
            <button id="reset-btn">RESET</button>
        </div>

        <div id="live-data-section">
            <h2>Live Data</h2>
            <div class="data-grid">
                <div class="data-item">v<sub>Bx</sub>: <span id="vbx-ui">0.0</span> m/s</div>
                <div class="data-item">v<sub>By</sub>: <span id="vby-ui">0.0</span> m/s</div>
                <div class="data-item">Time: <span id="time-ui">0.0</span>s</div>
                <div class="data-item">Drift: <span id="drift-ui">0.0</span>m</div>
            </div>
        </div>
    </div>

    <div id="main-area">
        <div id="canvas-container">
            <canvas id="simCanvas"></canvas>
        </div>
        <div id="observation-guide-container">
            <button class="nav-btn" id="prev-guide">PREV</button>
            <div id="guide-text"></div>
            <button class="nav-btn" id="next-guide">NEXT</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('canvas-container');

    const VR = 3.0, W = 20.0;
    let vBR = 4.0, thetaDeg = 0, isRunning = false, time = 0, timeScale = 1.0;
    let boat = { x: 0, y: 0 }, path = [];
    const MTP = 15; 

    let buoys = [
        { label: 'A', x: -4, y: 15, color: 'blue' },
        { label: 'B', x: 0, y: 15, color: 'red' },
        { label: 'C', x: 4, y: 15, color: 'green' }
    ];
    let activeBuoys = JSON.parse(JSON.stringify(buoys));

    // Updated Observation Guide Text
    const guidanceMessages = [
        "1. Observe change in vector diagram with changes made in control panel.",
        "2. Think of a way to control vBx and vBy using control panel.",
        "3. Note how vBx and vBy changes with the change in θ. What value of θ maximizes vBy?",
        "4. The drift depends on vBx, and it is zero when its value is zero. What adjustment would lead to zero drift?",
        "5. Try to set the parameters such that the boat touches the Blue or Green buoy on its path."
    ];
    let guideIndex = 0;

    function reset() {
        isRunning = false;
        time = 0;
        boat = { x: 0, y: 0 };
        path = [];
        activeBuoys = JSON.parse(JSON.stringify(buoys));
        document.getElementById('play-btn').textContent = "PLAY";
        updateUI();
        draw();
    }

    function update() {
        if (!isRunning) return;
        const dt = (1/60) * timeScale;
        const rad = (thetaDeg * Math.PI) / 180;
        const vBy = vBR * Math.cos(rad);
        const vBx = VR + vBR * Math.sin(rad);

        boat.y += vBy * dt;
        boat.x += vBx * dt;
        path.push({x: boat.x, y: boat.y});
        activeBuoys.forEach(b => b.x += VR * dt);
        time += dt;

        if (boat.y >= W) { boat.y = W; isRunning = false; }
        updateUI();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const startY = canvas.height - 80; 
        const endY = startY - (W * MTP);
        const originX = canvas.width / 4;

        // Banks
        ctx.fillStyle = "#d2b48c";
        ctx.fillRect(0, startY, canvas.width, 80); 
        ctx.fillRect(0, 0, canvas.width, endY); 

        // Trace
        ctx.setLineDash([5, 5]);
        ctx.strokeStyle = "rgba(255, 0, 0, 0.6)";
        ctx.beginPath();
        path.forEach((p, i) => {
            const px = originX + p.x * MTP;
            const py = startY - p.y * MTP;
            if(i===0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
        });
        ctx.stroke();
        ctx.setLineDash([]);

        // Axes (4m)
        ctx.strokeStyle = "black";
        ctx.lineWidth = 2;
        drawArrow(originX, startY, originX + 4*MTP, startY, "black", "X");
        drawArrow(originX, startY, originX, startY - 4*MTP, "black", "Y");

        // Buoys
        activeBuoys.forEach(b => {
            const bx = originX + b.x * MTP;
            const by = startY - b.y * MTP;
            ctx.fillStyle = b.color;
            ctx.beginPath(); ctx.arc(bx, by, 5, 0, 7); ctx.fill();
            ctx.font = "bold 12px Arial";
            ctx.fillText(b.label, bx - 4, by - 12);
        });

        // Boat
        ctx.save();
        ctx.translate(originX + boat.x * MTP, startY - boat.y * MTP);
        ctx.rotate((thetaDeg * Math.PI) / 180);
        ctx.fillStyle = "#5d4037";
        ctx.beginPath(); ctx.moveTo(0,-15); ctx.lineTo(8,10); ctx.lineTo(-8,10); ctx.closePath(); ctx.fill();
        ctx.fillStyle = "red"; ctx.beginPath(); ctx.arc(0,0,2.5,0,7); ctx.fill(); 
        ctx.restore();

        drawVectorPanel();
    }

    function drawVectorPanel() {
        const pW = 260, pH = 150;
        const pX = canvas.width - pW - 10, pY = canvas.height - pH - 10;
        ctx.fillStyle = "rgba(255,255,255,0.9)";
        ctx.fillRect(pX, pY, pW, pH);
        ctx.strokeRect(pX, pY, pW, pH);

        const ox = pX + 40, oy = pY + 110, s = 20;
        const rad = (thetaDeg * Math.PI) / 180;
        const vbrx = vBR*Math.sin(rad)*s, vbry = -vBR*Math.cos(rad)*s, vrx = VR*s;

        drawArrow(ox, oy, ox + vrx, oy, "blue", "vR");
        drawArrow(ox, oy, ox + vbrx, oy + vbry, "red", "vBR", -15);
        drawArrow(ox, oy, ox + vbrx + vrx, oy + vbry, "green", "vBG", 15);
    }

    function drawArrow(x1, y1, x2, y2, color, label, labelOffset = 10) {
        const head = 8, angle = Math.atan2(y2-y1, x2-x1);
        ctx.strokeStyle = color; ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
        ctx.fillStyle = color; ctx.beginPath(); ctx.moveTo(x2,y2);
        ctx.lineTo(x2-head*Math.cos(angle-0.5), y2-head*Math.sin(angle-0.5));
        ctx.lineTo(x2-head*Math.cos(angle+0.5), y2-head*Math.sin(angle+0.5)); ctx.fill();
        ctx.fillStyle = "#000"; ctx.fillText(label, x2 + Math.cos(angle)*labelOffset, y2 + Math.sin(angle)*labelOffset);
    }

    function updateUI() {
        const rad = (thetaDeg * Math.PI) / 180;
        document.getElementById('vbx-ui').textContent = (VR + vBR*Math.sin(rad)).toFixed(1);
        document.getElementById('vby-ui').textContent = (vBR*Math.cos(rad)).toFixed(1);
        document.getElementById('time-ui').textContent = time.toFixed(1);
        document.getElementById('drift-ui').textContent = boat.x.toFixed(1);
        document.getElementById('vbr-val').textContent = vBR + " m/s";
        document.getElementById('theta-val').textContent = thetaDeg + "°";
    }

    // Guide Navigation
    function updateGuide() {
        document.getElementById('guide-text').textContent = guidanceMessages[guideIndex];
    }

    document.getElementById('next-guide').onclick = () => {
        guideIndex = (guideIndex + 1) % guidanceMessages.length;
        updateGuide();
    };

    document.getElementById('prev-guide').onclick = () => {
        guideIndex = (guideIndex - 1 + guidanceMessages.length) % guidanceMessages.length;
        updateGuide();
    };

    // Controls listeners
    document.getElementById('vbr-slider').oninput = (e) => { vBR = +e.target.value; reset(); };
    document.getElementById('theta-slider').oninput = (e) => { thetaDeg = +e.target.value; reset(); };
    document.getElementById('time-scale').onchange = (e) => { timeScale = +e.target.value; };
    document.getElementById('play-btn').onclick = () => { 
        if (!isRunning && boat.y >= W) reset();
        isRunning = !isRunning; 
        document.getElementById('play-btn').textContent = isRunning ? "PAUSE" : "PLAY"; 
    };
    document.getElementById('reset-btn').onclick = reset;

    window.onresize = () => { canvas.width = container.clientWidth; canvas.height = container.clientHeight; reset(); };
    
    // Init
    updateGuide();
    window.onresize();
    function loop() { update(); draw(); requestAnimationFrame(loop); }
    loop();
</script>
</body>
</html>